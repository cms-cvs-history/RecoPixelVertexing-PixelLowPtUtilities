process TEST =
{
  # Logger
  service = MessageLogger
  {
    untracked vstring destinations = { "cerr" }
    untracked PSet cerr =
    {
      untracked string threshold = "ERROR"
    } 
    untracked vstring debugModules =  { }
  }

  # Source
  source = PoolSource
  { 
    include "RecoPixelVertexing/PixelLowPtUtilities/test/sourceRecHits_PbPb.cfi"
    untracked uint32 skipEvents = 1
  }

  # Pixel tracks
  include "RecoPixelVertexing/PixelLowPtUtilities/data/PixelLowPtTracksWithZPos.cff"

  # Pixel triplet tracks
  module  pixelTracks = pixelLowPtTracksWithZPos from
    "RecoPixelVertexing/PixelLowPtUtilities/data/PixelLowPtTracksWithZPos.cfi"
  replace pixelTracks.passLabel = "Pixel triplet tracks" 
  replace pixelTracks.RegionFactoryPSet.RegionPSet.ptMin        = 2.0 // [GeV/c]
  replace pixelTracks.RegionFactoryPSet.RegionPSet.originRadius = 0.1 // [cm]

  # Pixel triplet vertices
  include "RecoPixelVertexing/PixelVertexFinding/data/PixelVertexes.cff"
  replace pixelVertices.TrackCollection = pixelTracks
  replace pixelVertices.ZSeparation = 0.3 // [cm]
  replace pixelVertices.NTrkMin     = 100 
  replace pixelVertices.PtMin       = 0   // [GeV/c]

  # Pixel triplet tracks with vertices
  module  pixelTracksWithVertices = pixelLowPtTracksWithZPos from
    "RecoPixelVertexing/PixelLowPtUtilities/data/PixelLowPtTracksWithZPos.cfi"
  replace pixelTracksWithVertices.passLabel = "Pixel triplet tracks with vertices" 
  replace pixelTracksWithVertices.RegionFactoryPSet.RegionPSet.useFoundVertices = true
  replace pixelTracksWithVertices.RegionFactoryPSet.RegionPSet.originRadius = 0.1 // [cm]
  replace pixelTracksWithVertices.RegionFactoryPSet.RegionPSet.originHalfLength = 0.1 // [cm]

  # Pixel triplet tracks, secondaries 
# module  pixelTracksSecondaries = pixelLowPtTracksWithZPos from
#   "RecoPixelVertexing/PixelLowPtUtilities/data/PixelLowPtTracksWithZPos.cfi"
# replace pixelTracksSecondaries.passLabel = "Pixel triplet tracks, secondaries" 
# replace pixelTracksSecondaries.RegionFactoryPSet.RegionPSet.originRadius     = 3.5 // [cm]
# replace pixelTracksSecondaries.removeHitsOnTracks = true
# replace pixelTracksSecondaries.removeHitsList =
#   { "pixelTracksWithVertices" }

  # Pixel triplet seeds
  include "RecoPixelVertexing/PixelLowPtUtilities/data/PixelTrackSeeds.cff"
  replace pixelTrackSeeds.tripletList =
    { "pixelTracksWithVertices" }
#   { "pixelTracksWithVertices", "pixelTracksSecondaries" }

  # Pixel doublet seeds

  # Global tracks
  include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"
  replace CkfTrajectoryBuilder.ptCut                = 0.175 // [GeV/c]
  replace CkfTrajectoryBuilder.maxCand              = 3
  replace CkfTrajectoryBuilder.maxLostHit           = 1 
  replace CkfTrajectoryBuilder.maxConsecLostHit     = 1
  replace CkfTrajectoryBuilder.minimumNumberOfHits  = 6
  replace CkfTrajectoryBuilder.alwaysUseInvalidHits = false

  module ckfTripletTrackCandidates = ckfTrackCandidates from
    "RecoTracker/CkfPattern/data/CkfTrackCandidates.cfi"
  replace ckfTripletTrackCandidates.SeedProducer = "pixelTrackSeeds"

  # Final fit
  include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cff"
  module ctfTripletTracks = ctfWithMaterialTracks from
    "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cfi"
  replace ctfTripletTracks.src = "ckfTripletTrackCandidates"
  replace ctfTripletTracks.TrajectoryInEvent = true

  # Mixed
  
  # V0

  # Tracking truth
  include "SimGeneral/TrackingAnalysis/data/trackingParticles.cfi"
  es_module = TrackAssociatorByHitsESProducer
  {
    bool associateStrip = true
    bool associatePixel = true
    bool associateRecoTracks = true
    double MinHitFraction = 0.0
    vstring ROUList =
    {
     "TrackerHitsPixelBarrelLowTof","TrackerHitsPixelBarrelHighTof",
     "TrackerHitsPixelEndcapLowTof","TrackerHitsPixelEndcapHighTof",
     "TrackerHitsTIBLowTof","TrackerHitsTIBHighTof",
     "TrackerHitsTIDLowTof","TrackerHitsTIDHighTof",
     "TrackerHitsTOBLowTof","TrackerHitsTOBHighTof",
     "TrackerHitsTECLowTof","TrackerHitsTECHighTof"
    }
  }

  # Test
  module test = LowPtTrackAnalyzer
  {
    bool plotEvent = false
    bool zipFiles  = false
  }

  # Path
  path p =
  {
    pixelTracks,
    pixelVertices,
    pixelTracksWithVertices,
#   pixelTracksSecondaries,
    pixelTrackSeeds,
    ckfTripletTrackCandidates,
    ctfTripletTracks
#   pixelVZeros,
#   trackingParticles, test 
  }
}

